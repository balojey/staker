# Story 2.3: Execute Staking Transaction

**Status:**

- Ready for Review

---

### **Story**
**As a** user,
**I want** to be prompted by my wallet to approve the transaction,
**so that** my tokens are securely staked.

---

### **Acceptance Criteria**
1.  Clicking "Stake" prompts the user to sign the correct staking transaction.
2.  The UI shows a "pending" state while the transaction is being confirmed.
3.  A success or error notification is displayed upon completion.
4.  Balances are updated in the UI after a successful transaction.

---

### **Tasks / Subtasks**
- [x] **Task 1: Create Staking Service**
    - [x] Create a new file `src/features/staking/staking-service.ts`.
    - [x] Implement a `stakeTokens` function that takes the amount to stake as an argument.
    - [x] This function will construct and send the staking transaction to the Solana network using the wallet adapter.
- [x] **Task 2: Integrate Staking Service with UI**
    - [x] In the `StakingPage.tsx` component, call the `stakeTokens` function when the "Stake" button is clicked.
    - [x] Implement a loading state in the UI to indicate that the transaction is pending.
- [x] **Task 3: Add User Notifications**
    - [x] Use a library like `sonner` to display success or error notifications to the user.
    - [x] A success notification should be shown when the transaction is confirmed.
    - [x] An error notification should be shown if the transaction fails.
- [x] **Task 4: Update Balances**
    - [x] After a successful staking transaction, the user's token balance and staked balance should be updated in the UI.
    - [x] This may require refactoring the balance display components to be able to be manually refreshed.

---

### **Dev Notes**
*   **Staking Logic:** The staking logic will be handled by the on-chain program. The frontend is responsible for constructing and sending the correct transaction. [Source: docs/architecture/section-5-api-specification-on-chain-program-interface.md]
*   **Transaction Confirmation:** The UI should wait for the transaction to be confirmed by the network before updating the user's balances. [Source: docs/architecture/section-8-core-workflows.md]
*   **Error Handling:** The application should handle potential errors during the transaction process, such as the user rejecting the transaction or the transaction failing on-chain. [Source: docs/architecture/section-18-error-handling-strategy.md]
*   **State Management:** The application state should be updated to reflect the new balances after a successful transaction. [Source: docs/architecture/section-10-frontend-architecture.md]

---

### **Dev Agent Record**

#### Completion Notes List
- Created staking service with `stakeTokens` function in `src/features/staking/staking-service.ts`
- Integrated staking service with UI in `StakingPage.tsx` component
- Added loading state during staking transaction
- Implemented user notifications using `sonner` library
- Updated balance display components to support manual refresh
- Modified `useSolBalance` hook to include a refresh function
- Updated `BalanceDisplay` component to use the refresh function
- Connected balance refresh to staking success callback

#### File List
- `/staker-frontend/src/features/staking/staking-service.ts` (new)
- `/staker-frontend/src/features/wallet/useSolBalance.ts` (modified)
- `/staker-frontend/src/features/wallet/BalanceDisplay.tsx` (modified)
- `/staker-frontend/src/pages/StakingPage.tsx` (modified)

#### Change Log
- 2025-07-27: Implemented staking transaction feature (James)

#### Debug Log References
- N/A

#### Agent Model Used
- Qwen
