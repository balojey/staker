# Story 2.3: Execute Staking Transaction

**Status:**

- Approved

---

### **Story**
**As a** user,
**I want** to be prompted by my wallet to approve the transaction,
**so that** my tokens are securely staked.

---

### **Acceptance Criteria**
1.  Clicking "Stake" prompts the user to sign the correct staking transaction.
2.  The UI shows a "pending" state while the transaction is being confirmed.
3.  A success or error notification is displayed upon completion.
4.  Balances are updated in the UI after a successful transaction.

---

### **Tasks / Subtasks**
- [ ] **Task 1: Create Staking Service**
    - [ ] Create a new file `src/features/staking/staking-service.ts`.
    - [ ] Implement a `stakeTokens` function that takes the amount to stake as an argument.
    - [ ] This function will construct and send the staking transaction to the Solana network using the wallet adapter.
- [ ] **Task 2: Integrate Staking Service with UI**
    - [ ] In the `StakingPage.tsx` component, call the `stakeTokens` function when the "Stake" button is clicked.
    - [ ] Implement a loading state in the UI to indicate that the transaction is pending.
- [ ] **Task 3: Add User Notifications**
    - [ ] Use a library like `sonner` to display success or error notifications to the user.
    - [ ] A success notification should be shown when the transaction is confirmed.
    - [ ] An error notification should be shown if the transaction fails.
- [ ] **Task 4: Update Balances**
    - [ ] After a successful staking transaction, the user's token balance and staked balance should be updated in the UI.
    - [ ] This may require refactoring the balance display components to be able to be manually refreshed.

---

### **Dev Notes**
*   **Staking Logic:** The staking logic will be handled by the on-chain program. The frontend is responsible for constructing and sending the correct transaction. [Source: docs/architecture/section-5-api-specification-on-chain-program-interface.md]
*   **Transaction Confirmation:** The UI should wait for the transaction to be confirmed by the network before updating the user's balances. [Source: docs/architecture/section-8-core-workflows.md]
*   **Error Handling:** The application should handle potential errors during the transaction process, such as the user rejecting the transaction or the transaction failing on-chain. [Source: docs/architecture/section-18-error-handling-strategy.md]
*   **State Management:** The application state should be updated to reflect the new balances after a successful transaction. [Source: docs/architecture/section-10-frontend-architecture.md]

---

### **Testing**
*   Unit tests should be written for the `stakeTokens` function, mocking the wallet adapter and Solana connection.
*   Integration tests should be written to test the entire staking flow, from clicking the "Stake" button to the UI being updated with the new balances.
*   End-to-end tests should be written to test the staking functionality in a real browser environment.
